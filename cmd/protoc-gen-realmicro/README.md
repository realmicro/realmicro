# Generator

This is code generator for realmicro

## Install

First install protoc. You can do this with either your package manager, or [directly](https://github.com/protocolbuffers/protobuf/releases) by downloading `protoc-$VERSION-$PLATFORM.zip`

Then install `protoc-gen-go` and `protoc-gen-realmicro`.

```
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install github.com/realmicro/realmicro/cmd/protoc-gen-realmicro@latest
```

Also required:

- [protoc](https://github.com/google/protobuf)
- [protoc-gen-go](https://google.golang.org/protobuf)

## Usage

Define your service as `greeter.proto`

```
syntax = "proto3";

package greeter;
option go_package = "/proto;greeter";

service Greeter {
	rpc Hello(Request) returns (Response) {}
}

message Request {
	string name = 1;
}

message Response {
	string msg = 1;
}
```

Generate the code

```
protoc --proto_path=. --realmicro_out=. --go_out=. greeter.proto
```

Your output result should be:

```
./
    greeter.proto        # original protobuf file
    greeter.pb.go        # auto-generated by protoc-gen-go
    greeter.realmicro.go # auto-generated by protoc-gen-realmicro
```

The realmicro generated code includes clients and handlers which reduce boiler plate code

### Server

Register the handler with your micro server

```go
type Greeter struct{}

func (g *Greeter) Hello(ctx context.Context, req *proto.Request, rsp *proto.Response) error {
	rsp.Msg = "Hello " + req.Name
	return nil
}

proto.RegisterGreeterHandler(service.Server(), &Greeter{})
```

### Client

Create a service client with your micro client

```go
client := proto.NewGreeterService("greeter", service.Client())
```

### Errors

If you see an error about `protoc-gen-realmicro` not being found or executable, it's likely your environment may not be configured correctly. If you've already installed `protoc`, `protoc-gen-go`, and `protoc-gen-realmicro` ensure you've included `$GOPATH/bin` in your `PATH`.

Alternative specify the Go plugin paths as arguments to the `protoc` command

```
protoc --plugin=protoc-gen-go=$GOPATH/bin/protoc-gen-go --plugin=protoc-gen-realmicro=$GOPATH/bin/protoc-gen-realmicro --proto_path=. --micro_out=. --go_out=. greeter.proto
```

## LICENSE

protoc-gen-realmicro is a liberal reuse of protoc-gen-go hence we maintain the original license 